!function(e,t){"function"==typeof define&&define.amd?define([],t(e)):"object"==typeof exports?module.exports=t(e):e.gapein=t(e)}("undefined"!=typeof global?global:this.window||this.global,function(e){"use strict";var t,s,a,i,n,r={},o="querySelector"in document&&"addEventListener"in e&&"classList"in document.createElement("_"),l=[0],c=!0,m={itemClass:"gapein-item",activeClass:"gapein-active",triggerClass:"gapein-trigger",dataClass:"gapein-data",dividerClass:"gapein-divider",dividerElem:"div",loadingClass:"gapein-loading",loadingHeight:"120",previewClass:"gapein-preview",detailClass:"gapein-detail",closeClass:"gapein-close"},d=function(e,t,s){if("[object Object]"===Object.prototype.toString.call(e))for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.call(s,e[a],a,e);else for(var i=0,n=e.length;i<n;i++)t.call(s,e[i],i,e)},f=function(){var e={},t=!1,s=0,a=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(t=arguments[0],s++);for(;s<a;s++)!function(s){for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t&&"[object Object]"===Object.prototype.toString.call(s[a])?e[a]=f(!0,e[a],s[a]):e[a]=s[a])}(arguments[s]);return e},p=function(e,t){for(Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),s=t.length;--s>=0&&t.item(s)!==this;);return s>-1});e&&e!==document;e=e.parentNode)if(e.matches(t))return e;return null},v=function(e){var s=t.container.getElementsByClassName(t.dividerClass);if("offset"===e)a=function(e){l.push(e.offsetTop)};else{if("height"!==e)return;var a=function(e){e.style.height=""}}d(s,a)};r.showPreview=function(e){c&&(t.container.getElementsByClassName("for-row-1")[0].offsetTop!==l[1]&&(l=[0],v("offset")),c=!1);var s=e.getAttribute("data-row"),a=t.container.getElementsByClassName("for-row-"+s)[0],n=document.getElementById(t.previewId);if(n.style.display="none",n.style.opacity="0",i!==s){v("height");var r="translateY("+l[s]+"px)";n.style.webkitTransform=r,n.style.msTransform=r,n.style.transform=r,i=s}if(a.style.height=t.loadingHeight+"px",a.classList.add(t.loadingClass),e.classList.contains(t.dataClass))o=e;else var o=e.getElementsByClassName(t.dataClass)[0];if(void 0===(m=o.dataset))for(var m={},p=o.attributes,u=p.length,y=0;y<u;y++){var g=p[y].name.match(/^data-(.+)/);g&&(m[g[1]]=p[y].value)}var h=f({},m);delete h.row;var C=n.getElementsByClassName(t.detailClass);d(C,function(e){e.style.display="none",e.hasAttribute("src")?e.setAttribute("src",""):e.hasAttribute("href")&&e.setAttribute("href","#")});var E=!1,w=new Image;w.onerror=function(){console.error("Cannot load image")};for(var b in h)if(h.hasOwnProperty(b)){var B=b.match(/^src_(.+)/),N=b.match(/^href_(.+)/);if(B)"IMG"===(L=n.getElementsByClassName(b.slice(4))[0]).tagName&&(E=!0,w.src=h[b]),L.style.display="",L.setAttribute("src",h[b]);else if(N)(L=n.getElementsByClassName(b.slice(5))[0]).style.display="",L.setAttribute("href",h[b]);else{var L=n.getElementsByClassName(b)[0];L&&(L.style.display="",L.innerHTML=h[b])}}var A=function(){n.style.display="block",setTimeout(function(){var e=n.offsetHeight;a.classList.remove(t.loadingClass),a.style.height=e+"px",setTimeout(function(){n.style.opacity="1"},250)},150)};E?w.onload=function(){setTimeout(function(){A()},600)}:A()},r.hidePreview=function(e){if(t){d(e,function(e){e.classList.remove(t.activeClass)});var s=document.getElementById(t.previewId);v("height"),s.style.display="none",s.style.opacity="0"}};var u=function(e){if(0===e.button&&!e.metaKey&&!e.ctrlKey){var s=e.target,i=s.classList;("A"===s.tagName&&!i.contains("gapein-link")||i.contains(t.triggerClass))&&e.preventDefault();var n=t.container.getElementsByClassName(t.itemClass);if(i.contains(t.triggerClass)){if(!(a=i.contains(t.itemClass)?s:p(s,"."+t.itemClass))||a.classList.contains(t.activeClass))return;d(n,function(e){e.classList.remove(t.activeClass)}),a.classList.add(t.activeClass),r.showPreview(a)}i.contains(t.closeClass)&&r.hidePreview(n)}},y=function(a){s||(s=setTimeout(function(){s=null;var a=e.innerWidth;if(a!==n){n=a;var i=document.getElementById(t.previewId);i.style.display="none",i.style.opacity="0";r.destroy(!0),r.prep();var o=t.container.getElementsByClassName(t.activeClass)[0];o&&setTimeout(function(){r.showPreview(o)},100)}},250))};return r.prep=function(){if(t){for(var e=t.container.getElementsByClassName(t.itemClass),s=e.length,a=0,i=1,n=0;n<s;n++){var r=e[n].offsetTop;if(r!==a&&((o=document.createElement(t.dividerElem)).setAttribute("class",t.dividerClass+" for-row-"+i),e[n].parentNode.insertBefore(o,e[n]),i++,a=r),e[n].setAttribute("data-row",i),n==s-1){var o=document.createElement(t.dividerElem);o.setAttribute("class",t.dividerClass+" for-row-"+i),e[n].parentNode.insertBefore(o,e[n].nextSibling)}}t.container.getElementsByClassName(t.previewClass)[0].id=t.previewId,v("offset")}},r.destroy=function(a){if(t){var n=t.container.getElementsByClassName(t.itemClass);d(n,function(e){e.removeAttribute("data-row")});for(var r=t.container.getElementsByClassName(t.dividerClass);r[0];)r[0].parentNode.removeChild(r[0]);a||(t.container.removeEventListener("click",u,!1),e.removeEventListener("resize",y,!1),t=null,s=null),i=null,l=[0]}},r.init=function(s,a){if(o){if(!a)var a={};a.container=s,a.previewId=s.id+"-preview",r.destroy(),t=f(m,a);var i=function(){var e=t.container.getElementsByClassName(t.itemClass);e[e.length-1].offsetHeight>0?setTimeout(r.prep(),200):setTimeout(i,200)};i(),n=e.innerWidth,t.container.addEventListener("click",u,!1),e.addEventListener("resize",y,!1)}},r});